<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <script type="text/javascript" src="/homey.js" data-origin="pair"></script>
    <style>
      body { font-family: sans-serif; padding: 16px; }
      .log { background: #111; color: #0f0; padding: 8px; height: 220px; overflow:auto; font-family: monospace; }
      button { padding: 10px 16px; }
    </style>
  </head>
  <body>
    <h2>WiFi Pool - Add Device</h2>
    <p>Uses app settings (Email, Password, Domain). Make sure those are set before pairing.</p>
    <div class="log" id="log"></div>
    <p><button id="btn">Add WiFi Pool Device</button></p>
    <script>
      function onHomeyReady(Homey) {
        const log = (m)=>{ const el=document.getElementById('log'); el.textContent += m + "\n"; el.scrollTop = el.scrollHeight; };
        log('Pairing UI ready.');
        Homey.ready(); // stop spinner

        document.getElementById('btn').addEventListener('click', async () => {
          log('Creating device...');
          try {
            const result = await Homey.emit('add_device', {});
            log('Device created: ' + JSON.stringify(result));
            Homey.done();
          } catch(e) {
            log('Error: ' + (e && e.message ? e.message : e));
            Homey.alert('Error: ' + (e && e.message ? e.message : e));
          }
        });
      }
    </script>
  </body>
</html>
